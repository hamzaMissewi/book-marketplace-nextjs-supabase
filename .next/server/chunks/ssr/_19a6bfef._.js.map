{"version":3,"sources":["../../../../lib/orders.ts","../../../../.next-internal/server/app/orders/new/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["\"use server\";\nimport { createSupabaseClient } from \"@/lib/supabase/server\";\n\nexport interface OrderItem {\n  id: string;\n  order_id: string;\n  book_id: string;\n  price_cents: number;\n  quantity: number;\n  created_at: string;\n  books: {\n    id: string;\n    title: string;\n    author: string;\n    category: string;\n    cover_image_url: string;\n  };\n}\n\nexport interface Order {\n  id: string;\n  user_id: string;\n  stripe_session_id: string | null;\n  stripe_payment_intent_id: string | null;\n  total_amount_cents: number;\n  status: \"pending\" | \"completed\" | \"failed\";\n  created_at: string;\n  updated_at: string;\n  order_items?: OrderItem[];\n}\n\nexport async function getUserOrders(): Promise<Order[]> {\n  const supabase = await createSupabaseClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n  if (!user) return [];\n\n  const { data, error } = await supabase\n    .from(\"orders\")\n    .select(\n      `*,\n       order_items(\n         id,\n         order_id,\n         book_id,\n         price_cents,\n         quantity,\n         created_at,\n         books(id, title, author, cover_image_url)\n       )`\n    )\n    .eq(\"user_id\", user.id)\n    .order(\"created_at\", { ascending: false });\n\n  if (error) {\n    console.error(\"Error fetching orders:\", error);\n    return [];\n  }\n\n  return data || [];\n}\n\nexport async function getOrderById(orderId: string): Promise<Order | null> {\n  const supabase = await createSupabaseClient();\n\n  const {\n    data: { user },\n  } = await supabase.auth.getUser();\n  if (!user) return null;\n\n  const { data, error } = await supabase\n    .from(\"orders\")\n    .select(\n      `*,\n       order_items(\n         id,\n         order_id,\n         book_id,\n         price_cents,\n         quantity,\n         created_at,\n         books(id, title, author, cover_image_url)\n       )`\n    )\n    .eq(\"id\", orderId)\n    .eq(\"user_id\", user.id)\n    .single();\n\n  if (error) {\n    console.error(\"Error fetching order:\", error);\n    return null;\n  }\n\n  return data;\n}\n","export {getUserOrders as '0010ef3e687496c8a4b536ce7df46cf044ace23e69'} from 'ACTIONS_MODULE0'\nexport {getOrderById as '40b51e2299398d27a6ad27458973eb24c7aef78e26'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":"uDACA,EAAA,EAAA,CAAA,CAAA,OA8BO,eAAe,IACpB,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,oBAAA,AAAoB,IAErC,CACJ,KAAM,CAAE,MAAI,CAAE,CACf,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAC/B,GAAI,CAAC,EAAM,MAAO,EAAE,CAEpB,GAAM,MAAE,CAAI,CAAE,OAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,UACL,MAAM,CACL,CAAC;;;;;;;;;QASC,CAAC,EAEJ,EAAE,CAAC,UAAW,EAAK,EAAE,EACrB,KAAK,CAAC,aAAc,CAAE,UAAW,EAAM,UAE1C,AAAI,GACF,IADS,IACD,KAAK,CAAC,yBAA0B,GACjC,EAAE,EAGJ,GAAQ,EAAE,AACnB,CAEO,eAAe,EAAa,CAAe,EAChD,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,oBAAA,AAAoB,IAErC,CACJ,KAAM,MAAE,CAAI,CAAE,CACf,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAC/B,GAAI,CAAC,EAAM,OAAO,KAElB,GAAM,MAAE,CAAI,OAAE,CAAK,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,UACL,MAAM,CACL,CAAC;;;;;;;;;QASC,CAAC,EAEJ,EAAE,CAAC,KAAM,GACT,EAAE,CAAC,UAAW,EAAK,EAAE,EACrB,MAAM,UAET,AAAI,GACF,IADS,IACD,KAAK,CAAC,wBAAyB,GAChC,MAGF,CACT,0CAjEsB,EAiCA,IAjCA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,MAiCA,CAAA,EAAA,EAAA,uBAAA,EAAA,EAAA,6CAAA,gFChEtB,IAAA,EAAA,EAAA,CAAA,CAAA"}